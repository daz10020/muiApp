function Bglog_InitPostLog(){var e,f,g,h,i,j,k,l,m,a=(!!window.ActiveXObject||"ActiveXObject"in window)&&navigator.userAgent.indexOf("MSIE")>0&&parseInt(navigator.userAgent.match(/MSIE ([\d.]+)/)[1])<8,b=function(b,c){var f,g,d=$(b),e=d.attr("data_cyslogclickflag");return e&&e.split(",").indexOf(c)>-1?!0:(e?d.attr("data_cyslogclickflag",e+","+c):d.attr("data_cyslogclickflag",c),"1"==d.attr("cysRecommend")&&(""==channelLog.imageUrl&&Bglog_InitPostLogUrl(),(new Image).src=channelLog.imageUrl.replace("/postlog.gif?","/recommend.gif?")+"&logtype=0&rid="+d.attr("DataRid")+"&channelcode="+c+"&position="+d.attr("DataPosition")+"&engine="+d.attr("DataEngine")+"&score="+d.attr("DataScore")+"&datatype="+d.attr("DataType")+"&logts="+(new Date).getTime()),f=jQuery.fn.jquery.split("."),a||parseInt(f[0]+f[1])<18?d.click(function(){BglogPostLog(c,this)}):null!=d.attr("onclick")&&"undefined"!=typeof d.attr("onclick")?(g=d.attr("onclick"),d.attr("onclick","BglogPostLog('"+c+"',this);"+g)):d.attr("onclick","BglogPostLog('"+c+"',this);"),!0)},c=$("[data-channelid]"),d=c.length;for(e=0;d>e;e++)if(f=$(c[e]),g=f.attr("data-channelid"),h=f[0].tagName.toLowerCase(),i=f[0].type,"a"===h||"button"===h||"input"===h&&("button"===i||"submit"===i))b(f,g);else{for(j=f.find("a"),k=0;k<j.length;k++)b($(j[k]),g);for(l=f.find("input"),k=0;k<l.length;k++)("button"===l[k].type||"submit"===l[k].type)&&b($(l[k]),g);for(m=f.find("button"),k=0;k<m.length;k++)b($(m[k]),g)}}function Bglog_InitPostLogUrl(){"undefined"!=typeof Bitauto&&Bitauto&&"undefined"!=typeof Bitauto.Login&&Bitauto.Login?Bitauto.Login.onComplatedHandlers.add("memory once",function(a){a.isLogined?channelLog.Init(a.userId,a.userName):channelLog.Init()}):channelLog.Init()}function BglogPostLog(a,b,c){"undefined"!=typeof a&&""!=a&&channelLog.SendLog(a,b,c)}var channelLog={domain:"bglog.bitauto.com",apidomain:"api.cheyisou.com",bglogId:"",DC:null,imageUrl:"",Init:function(a,b){var c,d;this.imageUrl="http://"+this.domain+"/postlog.gif?",c=this.Methods.Cookie.getCookie("UserGuid"),d=this,c.length>0?d.InitUrl(a,b):this.Methods.GetbglogId().done(function(){d.InitUrl(a,b)})},InitUrl:function(a,b){var d,c=this.imageUrl;try{this.DC=this.Methods.DCInit(),this.bglogId=this.Methods.Cookie.getCookie("UserGuid");for(d in this.DC)this.DC[d]&&(c+="&"+d+"="+this.Methods.Escape(this.DC[d],this.Methods.RE));c+="&b="+this.bglogId,"undefined"!=typeof a&&"undefined"!=typeof b&&a&&b&&(c+="&u="+a+","+b),this.imageUrl=c}catch(e){}},SendLog:function(a,b,c){var d,e,f;""==this.imageUrl&&Bglog_InitPostLogUrl(),d=$(b),e=this.imageUrl;try{if("undefined"!=typeof ChannelLOGCollector)for(f in ChannelLOGCollector)ChannelLOGCollector[f]&&(e+="&"+f+"="+this.Methods.Escape(ChannelLOGCollector[f],this.Methods.RE));"undefined"!=typeof a&&(e+="&channel="+a),"undefined"!=typeof d.attr("href")&&(e+="&linkurl="+this.Methods.Escape(d.attr("href"),this.Methods.RE)),"a"===d[0].tagName.toLowerCase()&&"undefined"!=typeof d.text()&&(e+="&title="+this.Methods.Escape(d.text().replace(/(^\s+)|(\s+$)/g, ""),this.Methods.RE)),e.length>2048&&navigator.userAgent.indexOf("MSIE")>=0&&(e=e.substring(0,2042)+"&sub=1"),"undefined"!=typeof c&&1===c?(new Image).src=e.replace("/postlog.gif?","/expose.gif?")+"&logts="+(new Date).getTime():("1"==d.attr("cysRecommend")&&((new Image).src=channelLog.imageUrl.replace("/postlog.gif?","/recommend.gif?")+"&logtype=1&rid="+d.attr("DataRid")+"&channelcode="+a+"&position="+d.attr("DataPosition")+"&engine="+d.attr("DataEngine")+"&score="+d.attr("DataScore")+"&datatype="+d.attr("DataType")+"&logts="+(new Date).getTime(),(new Image).src="http://"+this.apidomain+"/Recommend/RecomClickLog.aspx?ukey="+this.bglogId+"&rid="+d.attr("DataRid")+"&ub="+a+"&up="+d.attr("DataPosition")+"&en="+d.attr("DataEngine")+"&sc="+d.attr("DataScore")+"&dt="+d.attr("DataType")+"&logts="+(new Date).getTime()),(new Image).src=e+"&logts="+(new Date).getTime())}catch(g){}},Methods:{DCInit:function(){var c,a=new Object,b=window.document.referrer;return""!=b&&"-"!=b&&(a.ref=this.Encode(b)),c=document.URL||window.document.URL,a.url=this.Encode(c),a},GetbglogId:function(){function d(){for(var a=0;a<b.length;a++)if(b[a].indexOf(c)>-1){b.splice(a,1);break}}function e(){var c=channelLog.Methods.Cookie.getCookie("UserGuid"),d=[];$.each(b,function(a,b){d.push($.getScript("http://"+b+"/clientApi/UserTraceCookie?key=UserGuid&val="+c))}),$.when(d).done(function(){a.resolve()})}function f(){$.getScript("http://api.i."+c+"/clientApi/UserTraceCookie").done(e)}var a=$.Deferred(),b=["api.i.yiche.com","api.i.bitauto.com","api.i.cheyisou.com"],c=document.domain.split(".").slice(-2).join(".");return d(),f(),setTimeout(function(){a.reject()},3e3),a.promise()},RE:{"%09":/\t/g,"%20":/ /g,"%23":/\#/g,"%26":/\&/g,"%2B":/\+/g,"%3F":/\?/g,"%5C":/\\/g,"%22":/\"/g,"%7F":/\x7F/g,"%A0":/\xA0/g},Encode:function(a){return"function"==typeof encodeURIComponent?encodeURIComponent(a):escape(a)},Escape:function(a,b){var c,d;if(window.RegExp&&"undefined"!=typeof b){c=new String(a);for(d in b)c=c.replace(b[d],d);return c}return escape(a)},guidGenerator:function(){var a=function(){return(0|65536*(1+Math.random())).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},Cookie:{setCookie:function(a,b,c,d,e){var g,h,f=a+"="+encodeURIComponent(b);"undefined"!=typeof c&&c&&(g=new Date,h=1e3*3600*c,g.setTime(g.getTime()+h),f+="; expires="+g.toGMTString()),!d&&(d="/"),!e&&(e=document.domain),f+=";path="+d+";domain="+e,document.cookie=f},getCookie:function(a){var b=document.cookie.match(new RegExp("(^| )"+a+"=([^;]*)(;|$)"));return null!=b?unescape(b[2]):""},clearCookie:function(a,b){this.getCookie(a)&&(document.cookie=a+"="+(b?"; path="+b:"; path=/")+";expires=Fri, 02-Jan-1970 00:00:00 GMT")}}}};!function(){Bglog_InitPostLogUrl();var a=window.onload;window.onload="function"!=typeof window.onload?Bglog_InitPostLog:function(){a(),Bglog_InitPostLog()}}();
